import 'package:flutter/material.dart';
import 'package:free_malware_detection/home/widgets/widgets.dart';
import 'package:freerasp/freerasp.dart';

extension on PackageInfo {
  String get validAppName => appName ?? packageName;
}

/// List tile widget that displays malware information
class MalwareItem extends StatelessWidget {
  /// Represents malware information in the example app
  const MalwareItem({
    required this.packageInfo,
    required this.reason,
    this.onWhitelist,
    this.onUninstall,
    this.onDismiss,
    super.key,
  });

  final PackageInfo packageInfo;
  final String reason;
  final void Function()? onWhitelist;
  final void Function()? onUninstall;
  final void Function()? onDismiss;

  @override
  Widget build(BuildContext context) {
    return Dismissible(
      key: ValueKey(packageInfo.packageName),
      onDismissed: (_) => onDismiss?.call(),
      direction: DismissDirection.startToEnd,
      background: const DismissBackground(message: 'Dismiss'),
      child: ExpansionTile(
        tilePadding: const EdgeInsets.all(8),
        title: Text(packageInfo.validAppName),
        leading: AppIcon(base64Icon: packageInfo.appIcon),
        children: [
          ListTile(
            title: const Text('Package Name'),
            subtitle: Text(packageInfo.packageName),
          ),
          ListTile(
            title: const Text('Installation Source'),
            subtitle: Text(packageInfo.installationSource ?? 'Unknown'),
          ),
          ListTile(
            title: const Text('Version'),
            subtitle: Text(packageInfo.version ?? 'Unknown'),
          ),
          ListTile(
            title: const Text('Detection Reason'),
            subtitle: Text(reason),
          ),
          ButtonBar(
            children: [
              TextButton(
                onPressed: () => onWhitelist?.call(),
                child: const Text('Whitelist'),
              ),
              TextButton(
                onPressed: () => onUninstall?.call(),
                child: const Text('Uninstall'),
              ),
            ],
          ),
        ],
      ),
    );
  }
}
